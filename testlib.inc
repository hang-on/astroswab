; testlib.inc
; Macros, functions and data for testing library.

; -----------------------------------------------------------------------------
;                         M A C R O S
; -----------------------------------------------------------------------------
; -----------------------------------------------------------------------------
.macro assertEqualsA ; (value, fail string)
; -----------------------------------------------------------------------------
  cp \1
  jp z,+
    fail \2
  +:
.endm

; -----------------------------------------------------------------------------
.macro assertNotEqualsA ; (value, fail string)
; -----------------------------------------------------------------------------
  cp \1
  jp nz,+
  fail \2
  +:
.endm

; -----------------------------------------------------------------------------
.macro assertEqualsHL ; (value, fail string)
; -----------------------------------------------------------------------------
  ld de,\1
  ld a,d
  cp h
  jp nz,+
  ld a,e
  cp l
  jp z,++
  +:
    fail \2
  ++:
.endm

; -----------------------------------------------------------------------------
.macro assertEqualsByte ; (byte-sized variable, value, fail string)
; -----------------------------------------------------------------------------
  ld a,(\1)
  ld b,\2
  cp b
  jp z,+
    fail \3
  +:
  log "."
.endm

; -----------------------------------------------------------------------------
.macro assertEqualsWord ; (word-sized variable, value, fail string)
; -----------------------------------------------------------------------------
  ld hl,(\1)
  ld de,\2
  sbc hl,de
  jp z,+
    fail \3
  +:
.endm


; -----------------------------------------------------------------------------
.macro assertCarrySet ; (fail string)
; -----------------------------------------------------------------------------
  jp c,+
    fail \1
  +:
.endm

; -----------------------------------------------------------------------------
.macro assertCarryReset ; (fail string)
; -----------------------------------------------------------------------------
  jp nc,+
    fail \1
  +:
.endm

; -----------------------------------------------------------------------------
.macro fail ; (fail string)
; -----------------------------------------------------------------------------
  log "Assertion failed:               --> "
  log \1
  abort
.endm

; -----------------------------------------------------------------------------
.macro log
; -----------------------------------------------------------------------------
  ld hl,logData\@
  ld b,3
  ld c,1
  call print
  jp logDataEnd\@
  logData\@:
    .asc \1
    .asc "#"
  logDataEnd\@:
.endm

; -----------------------------------------------------------------------------
.macro abort
; -----------------------------------------------------------------------------
    .if nargs == 1
      log \1
    .endif
    -:
      nop
    jp -
.endm
